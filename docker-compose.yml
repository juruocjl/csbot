services:
  db:
    image: postgres:15-alpine  # 改用 postgres 镜像 (推荐 alpine 版本，体积小)
    container_name: csbot-database
    restart: unless-stopped
    environment:
      # PostgreSQL 的环境变量名不一样，请注意修改
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-password} # 对应 MySQL 的 ROOT_PASSWORD
      POSTGRES_USER: postgres  # 默认超级用户，相当于 MySQL 的 root
      POSTGRES_DB: csbot       # 对应 MYSQL_DATABASE
    ports:
      - "5432:5432"            # PostgreSQL 默认端口是 5432
    volumes:
      # 注意：PostgreSQL 容器内的数据目录是 /var/lib/postgresql/data
      - ./pg_data:/var/lib/postgresql/data 
    # command: ... (PostgreSQL 不需要那个 mysql_native_password 的命令，直接删掉)

  adminer:
    image: adminer
    restart: unless-stopped
    ports:
      - "8081:8080"
  nginx:
    image: nginx:alpine
    container_name: csbot-nginx
    restart: unless-stopped
    environment:
      - WORKER_SECRET=${REAL_WORKER_SECRET}
    ports:
      - "80:80"
      - "8000:8000"
    volumes:
      - ./assets/default.conf:/etc/nginx/templates/default.conf.template
      - ./imgs/:/usr/share/nginx/imgs/
      - ./dist/:/usr/share/nginx/html/
    extra_hosts:
      - "host.docker.internal:host-gateway"
  napcat:
    image: mlikiowa/napcat-docker:latest
    container_name: csbot-napcat
    ports:
      - 6099:6099
    restart: unless-stopped
    volumes:
      - ./napcat/config:/app/napcat/config
      - ./ntqq:/app/.config/QQ
    extra_hosts:
      - "host.docker.internal:host-gateway"
  cloudflared:
    image: cloudflare/cloudflared:latest
    container_name: csbot-tunnel
    restart: unless-stopped
    command: tunnel --no-autoupdate run --token ${TUNNEL_TOKEN}
    extra_hosts:
      - "host.docker.internal:host-gateway"